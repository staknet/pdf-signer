<!-- Â© 2025 staknet | Do not self-host or redistribute without permission -->


<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Signer</title>
    <script src="https://unpkg.com/pdf-lib@1.17.1"></script>
    <script src="https://unpkg.com/downloadjs@1.4.7"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.5/dist/signature_pad.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>

    <style>
        body {
            background: linear-gradient(135deg, #f0f9ff 0%, #e1f1ff 100%);
            min-height: 100vh;
        }

        .signature-pad {
            border: 2px dashed #3b82f6;
            border-radius: 8px;
            background-color: white;
        }

        .pdf-container {
            background-color: #f8fafc;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 900px;
            margin: auto;
            overflow-x: auto;
            padding: 10px;
            height: auto;
            box-sizing: border-box;
            position: relative;
        }

        .btn-primary {
            background-color: #3b82f6;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #2563eb;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background-color: #f3f4f6;
            color: #4b5563;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background-color: #e5e7eb;
            transform: translateY(-1px);
        }

        .upload-area {
            border: 2px dashed #cbd5e1;
            background-color: #f8fafc;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: #3b82f6;
            background-color: #f0f9ff;
        }

        .signature-tab.active {
            border-bottom: 3px solid #3b82f6;
            color: #3b82f6;
            font-weight: 600;
        }

        .pdf-page {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            margin-bottom: 20px;
        }

        canvas.pdf-page {
            width: 100% !important;
            height: auto !important;
            display: block;
        }

        .signature-preview {
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            padding: 8px;
            margin-top: 8px;
            background-color: white;
        }

        .signature-item {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .signature-item:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .signature-item.selected {
            border: 2px solid #3b82f6;
        }

        .drag-signature {
            cursor: move;
            user-select: none;
            position: absolute;
            z-index: 100;
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px dashed #3b82f6;
            padding: 4px;
        }
    </style>
    <style>
        *,
        ::before,
        ::after {
            --tw-border-spacing-x: 0;
            --tw-border-spacing-y: 0;
            --tw-translate-x: 0;
            --tw-translate-y: 0;
            --tw-rotate: 0;
            --tw-skew-x: 0;
            --tw-skew-y: 0;
            --tw-scale-x: 1;
            --tw-scale-y: 1;
            --tw-pan-x: ;
            --tw-pan-y: ;
            --tw-pinch-zoom: ;
            --tw-scroll-snap-strictness: proximity;
            --tw-gradient-from-position: ;
            --tw-gradient-via-position: ;
            --tw-gradient-to-position: ;
            --tw-ordinal: ;
            --tw-slashed-zero: ;
            --tw-numeric-figure: ;
            --tw-numeric-spacing: ;
            --tw-numeric-fraction: ;
            --tw-ring-inset: ;
            --tw-ring-offset-width: 0px;
            --tw-ring-offset-color: #fff;
            --tw-ring-color: rgb(59 130 246 / 0.5);
            --tw-ring-offset-shadow: 0 0 #0000;
            --tw-ring-shadow: 0 0 #0000;
            --tw-shadow: 0 0 #0000;
            --tw-shadow-colored: 0 0 #0000;
            --tw-blur: ;
            --tw-brightness: ;
            --tw-contrast: ;
            --tw-grayscale: ;
            --tw-hue-rotate: ;
            --tw-invert: ;
            --tw-saturate: ;
            --tw-sepia: ;
            --tw-drop-shadow: ;
            --tw-backdrop-blur: ;
            --tw-backdrop-brightness: ;
            --tw-backdrop-contrast: ;
            --tw-backdrop-grayscale: ;
            --tw-backdrop-hue-rotate: ;
            --tw-backdrop-invert: ;
            --tw-backdrop-opacity: ;
            --tw-backdrop-saturate: ;
            --tw-backdrop-sepia: ;
            --tw-contain-size: ;
            --tw-contain-layout: ;
            --tw-contain-paint: ;
            --tw-contain-style:
        }

        ::backdrop {
            --tw-border-spacing-x: 0;
            --tw-border-spacing-y: 0;
            --tw-translate-x: 0;
            --tw-translate-y: 0;
            --tw-rotate: 0;
            --tw-skew-x: 0;
            --tw-skew-y: 0;
            --tw-scale-x: 1;
            --tw-scale-y: 1;
            --tw-pan-x: ;
            --tw-pan-y: ;
            --tw-pinch-zoom: ;
            --tw-scroll-snap-strictness: proximity;
            --tw-gradient-from-position: ;
            --tw-gradient-via-position: ;
            --tw-gradient-to-position: ;
            --tw-ordinal: ;
            --tw-slashed-zero: ;
            --tw-numeric-figure: ;
            --tw-numeric-spacing: ;
            --tw-numeric-fraction: ;
            --tw-ring-inset: ;
            --tw-ring-offset-width: 0px;
            --tw-ring-offset-color: #fff;
            --tw-ring-color: rgb(59 130 246 / 0.5);
            --tw-ring-offset-shadow: 0 0 #0000;
            --tw-ring-shadow: 0 0 #0000;
            --tw-shadow: 0 0 #0000;
            --tw-shadow-colored: 0 0 #0000;
            --tw-blur: ;
            --tw-brightness: ;
            --tw-contrast: ;
            --tw-grayscale: ;
            --tw-hue-rotate: ;
            --tw-invert: ;
            --tw-saturate: ;
            --tw-sepia: ;
            --tw-drop-shadow: ;
            --tw-backdrop-blur: ;
            --tw-backdrop-brightness: ;
            --tw-backdrop-contrast: ;
            --tw-backdrop-grayscale: ;
            --tw-backdrop-hue-rotate: ;
            --tw-backdrop-invert: ;
            --tw-backdrop-opacity: ;
            --tw-backdrop-saturate: ;
            --tw-backdrop-sepia: ;
            --tw-contain-size: ;
            --tw-contain-layout: ;
            --tw-contain-paint: ;
            --tw-contain-style:
        }

        /* ! tailwindcss v3.4.16 | MIT License | https://tailwindcss.com */
        *,
        ::after,
        ::before {
            box-sizing: border-box;
            border-width: 0;
            border-style: solid;
            border-color: #e5e7eb
        }

        ::after,
        ::before {
            --tw-content: ''
        }

        :host,
        html {
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
            -moz-tab-size: 4;
            tab-size: 4;
            font-family: ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            font-feature-settings: normal;
            font-variation-settings: normal;
            -webkit-tap-highlight-color: transparent
        }

        body {
            margin: 0;
            line-height: inherit
        }

        hr {
            height: 0;
            color: inherit;
            border-top-width: 1px
        }

        abbr:where([title]) {
            -webkit-text-decoration: underline dotted;
            text-decoration: underline dotted
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-size: inherit;
            font-weight: inherit
        }

        a {
            color: inherit;
            text-decoration: inherit
        }

        b,
        strong {
            font-weight: bolder
        }

        code,
        kbd,
        pre,
        samp {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-feature-settings: normal;
            font-variation-settings: normal;
            font-size: 1em
        }

        small {
            font-size: 80%
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative;
            vertical-align: baseline
        }

        sub {
            bottom: -.25em
        }

        sup {
            top: -.5em
        }

        table {
            text-indent: 0;
            border-color: inherit;
            border-collapse: collapse
        }

        button,
        input,
        optgroup,
        select,
        textarea {
            font-family: inherit;
            font-feature-settings: inherit;
            font-variation-settings: inherit;
            font-size: 100%;
            font-weight: inherit;
            line-height: inherit;
            letter-spacing: inherit;
            color: inherit;
            margin: 0;
            padding: 0
        }

        button,
        select {
            text-transform: none
        }

        button,
        input:where([type=button]),
        input:where([type=reset]),
        input:where([type=submit]) {
            -webkit-appearance: button;
            background-color: transparent;
            background-image: none
        }

        :-moz-focusring {
            outline: auto
        }

        :-moz-ui-invalid {
            box-shadow: none
        }

        progress {
            vertical-align: baseline
        }

        ::-webkit-inner-spin-button,
        ::-webkit-outer-spin-button {
            height: auto
        }

        [type=search] {
            -webkit-appearance: textfield;
            outline-offset: -2px
        }

        ::-webkit-search-decoration {
            -webkit-appearance: none
        }

        ::-webkit-file-upload-button {
            -webkit-appearance: button;
            font: inherit
        }

        summary {
            display: list-item
        }

        blockquote,
        dd,
        dl,
        figure,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        hr,
        p,
        pre {
            margin: 0
        }

        fieldset {
            margin: 0;
            padding: 0
        }

        legend {
            padding: 0
        }

        menu,
        ol,
        ul {
            list-style: none;
            margin: 0;
            padding: 0
        }

        dialog {
            padding: 0
        }

        textarea {
            resize: vertical
        }

        input::placeholder,
        textarea::placeholder {
            opacity: 1;
            color: #9ca3af
        }

        [role=button],
        button {
            cursor: pointer
        }

        :disabled {
            cursor: default
        }

        audio,
        canvas,
        embed,
        iframe,
        img,
        object,
        svg,
        video {
            display: block;
            vertical-align: middle
        }

        img,
        video {
            max-width: 100%;
            height: auto
        }

        [hidden]:where(:not([hidden=until-found])) {
            display: none
        }

        .container {
            width: 100%
        }

        @media (min-width: 640px) {
            .container {
                max-width: 640px
            }
        }

        @media (min-width: 768px) {
            .container {
                max-width: 768px
            }
        }

        @media (min-width: 1024px) {
            .container {
                max-width: 1024px
            }
        }

        @media (min-width: 1280px) {
            .container {
                max-width: 1280px
            }
        }

        @media (min-width: 1536px) {
            .container {
                max-width: 1536px
            }
        }

        .col-span-2 {
            grid-column: span 2 / span 2
        }

        .mx-auto {
            margin-left: auto;
            margin-right: auto
        }

        .mb-1 {
            margin-bottom: 0.25rem
        }

        .mb-2 {
            margin-bottom: 0.5rem
        }

        .mb-3 {
            margin-bottom: 0.75rem
        }

        .mb-4 {
            margin-bottom: 1rem
        }

        .mb-6 {
            margin-bottom: 1.5rem
        }

        .mb-8 {
            margin-bottom: 2rem
        }

        .mr-2 {
            margin-right: 0.5rem
        }

        .mt-3 {
            margin-top: 0.75rem
        }

        .mt-6 {
            margin-top: 1.5rem
        }

        .block {
            display: block
        }

        .inline-block {
            display: inline-block
        }

        .flex {
            display: flex
        }

        .grid {
            display: grid
        }

        .hidden {
            display: none
        }

        .h-12 {
            height: 3rem
        }

        .h-16 {
            height: 4rem
        }

        .h-5 {
            height: 1.25rem
        }

        .h-8 {
            height: 2rem
        }

        .min-h-\[500px\] {
            min-height: 500px
        }

        .w-12 {
            width: 3rem
        }

        .w-16 {
            width: 4rem
        }

        .w-5 {
            width: 1.25rem
        }

        .w-8 {
            width: 2rem
        }

        .w-full {
            width: 100%
        }

        .max-w-6xl {
            max-width: 72rem
        }

        .flex-1 {
            flex: 1 1 0%
        }

        .cursor-pointer {
            cursor: pointer
        }

        .grid-cols-1 {
            grid-template-columns: repeat(1, minmax(0, 1fr))
        }

        .grid-cols-2 {
            grid-template-columns: repeat(2, minmax(0, 1fr))
        }

        .items-center {
            align-items: center
        }

        .justify-center {
            justify-content: center
        }

        .justify-between {
            justify-content: space-between
        }

        .gap-3 {
            gap: 0.75rem
        }

        .gap-8 {
            gap: 2rem
        }

        .space-x-3> :not([hidden])~ :not([hidden]) {
            --tw-space-x-reverse: 0;
            margin-right: calc(0.75rem * var(--tw-space-x-reverse));
            margin-left: calc(0.75rem * calc(1 - var(--tw-space-x-reverse)))
        }

        .rounded-lg {
            border-radius: 0.5rem
        }

        .rounded-md {
            border-radius: 0.375rem
        }

        .border {
            border-width: 1px
        }

        .border-b {
            border-bottom-width: 1px
        }

        .border-gray-200 {
            --tw-border-opacity: 1;
            border-color: rgb(229 231 235 / var(--tw-border-opacity, 1))
        }

        .border-gray-300 {
            --tw-border-opacity: 1;
            border-color: rgb(209 213 219 / var(--tw-border-opacity, 1))
        }

        .bg-white {
            --tw-bg-opacity: 1;
            background-color: rgb(255 255 255 / var(--tw-bg-opacity, 1))
        }

        .p-2 {
            padding: 0.5rem
        }

        .p-4 {
            padding: 1rem
        }

        .p-6 {
            padding: 1.5rem
        }

        .p-8 {
            padding: 2rem
        }

        .px-3 {
            padding-left: 0.75rem;
            padding-right: 0.75rem
        }

        .px-4 {
            padding-left: 1rem;
            padding-right: 1rem
        }

        .px-6 {
            padding-left: 1.5rem;
            padding-right: 1.5rem
        }

        .py-1 {
            padding-top: 0.25rem;
            padding-bottom: 0.25rem
        }

        .py-2 {
            padding-top: 0.5rem;
            padding-bottom: 0.5rem
        }

        .py-4 {
            padding-top: 1rem;
            padding-bottom: 1rem
        }

        .py-8 {
            padding-top: 2rem;
            padding-bottom: 2rem
        }

        .text-center {
            text-align: center
        }

        .font-sans {
            font-family: ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"
        }

        .text-4xl {
            font-size: 2.25rem;
            line-height: 2.5rem
        }

        .text-lg {
            font-size: 1.125rem;
            line-height: 1.75rem
        }

        .text-sm {
            font-size: 0.875rem;
            line-height: 1.25rem
        }

        .text-xl {
            font-size: 1.25rem;
            line-height: 1.75rem
        }

        .font-bold {
            font-weight: 700
        }

        .font-medium {
            font-weight: 500
        }

        .font-semibold {
            font-weight: 600
        }

        .text-blue-500 {
            --tw-text-opacity: 1;
            color: rgb(59 130 246 / var(--tw-text-opacity, 1))
        }

        .text-gray-400 {
            --tw-text-opacity: 1;
            color: rgb(156 163 175 / var(--tw-text-opacity, 1))
        }

        .text-gray-500 {
            --tw-text-opacity: 1;
            color: rgb(107 114 128 / var(--tw-text-opacity, 1))
        }

        .text-gray-600 {
            --tw-text-opacity: 1;
            color: rgb(75 85 99 / var(--tw-text-opacity, 1))
        }

        .text-gray-700 {
            --tw-text-opacity: 1;
            color: rgb(55 65 81 / var(--tw-text-opacity, 1))
        }

        .text-gray-800 {
            --tw-text-opacity: 1;
            color: rgb(31 41 55 / var(--tw-text-opacity, 1))
        }

        .shadow-lg {
            --tw-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);
            box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)
        }

        .focus\:outline-none:focus {
            outline: 2px solid transparent;
            outline-offset: 2px
        }

        .focus\:ring-2:focus {
            --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
            --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);
            box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)
        }

        .focus\:ring-blue-500:focus {
            --tw-ring-opacity: 1;
            --tw-ring-color: rgb(59 130 246 / var(--tw-ring-opacity, 1))
        }

        @media (min-width: 1024px) {
            .lg\:col-span-1 {
                grid-column: span 1 / span 1
            }

            .lg\:col-span-2 {
                grid-column: span 2 / span 2
            }

            .lg\:grid-cols-3 {
                grid-template-columns: repeat(3, minmax(0, 1fr))
            }
        }
    </style>
    <link
        href="https://fonts.googleapis.com/css2?family=Dancing+Script&amp;family=Pacifico&amp;family=Caveat&amp;display=swap"
        rel="stylesheet">
    <style>
        *,
        ::before,
        ::after {
            --tw-border-spacing-x: 0;
            --tw-border-spacing-y: 0;
            --tw-translate-x: 0;
            --tw-translate-y: 0;
            --tw-rotate: 0;
            --tw-skew-x: 0;
            --tw-skew-y: 0;
            --tw-scale-x: 1;
            --tw-scale-y: 1;
            --tw-pan-x: ;
            --tw-pan-y: ;
            --tw-pinch-zoom: ;
            --tw-scroll-snap-strictness: proximity;
            --tw-gradient-from-position: ;
            --tw-gradient-via-position: ;
            --tw-gradient-to-position: ;
            --tw-ordinal: ;
            --tw-slashed-zero: ;
            --tw-numeric-figure: ;
            --tw-numeric-spacing: ;
            --tw-numeric-fraction: ;
            --tw-ring-inset: ;
            --tw-ring-offset-width: 0px;
            --tw-ring-offset-color: #fff;
            --tw-ring-color: rgb(59 130 246 / 0.5);
            --tw-ring-offset-shadow: 0 0 #0000;
            --tw-ring-shadow: 0 0 #0000;
            --tw-shadow: 0 0 #0000;
            --tw-shadow-colored: 0 0 #0000;
            --tw-blur: ;
            --tw-brightness: ;
            --tw-contrast: ;
            --tw-grayscale: ;
            --tw-hue-rotate: ;
            --tw-invert: ;
            --tw-saturate: ;
            --tw-sepia: ;
            --tw-drop-shadow: ;
            --tw-backdrop-blur: ;
            --tw-backdrop-brightness: ;
            --tw-backdrop-contrast: ;
            --tw-backdrop-grayscale: ;
            --tw-backdrop-hue-rotate: ;
            --tw-backdrop-invert: ;
            --tw-backdrop-opacity: ;
            --tw-backdrop-saturate: ;
            --tw-backdrop-sepia: ;
            --tw-contain-size: ;
            --tw-contain-layout: ;
            --tw-contain-paint: ;
            --tw-contain-style:
        }

        ::backdrop {
            --tw-border-spacing-x: 0;
            --tw-border-spacing-y: 0;
            --tw-translate-x: 0;
            --tw-translate-y: 0;
            --tw-rotate: 0;
            --tw-skew-x: 0;
            --tw-skew-y: 0;
            --tw-scale-x: 1;
            --tw-scale-y: 1;
            --tw-pan-x: ;
            --tw-pan-y: ;
            --tw-pinch-zoom: ;
            --tw-scroll-snap-strictness: proximity;
            --tw-gradient-from-position: ;
            --tw-gradient-via-position: ;
            --tw-gradient-to-position: ;
            --tw-ordinal: ;
            --tw-slashed-zero: ;
            --tw-numeric-figure: ;
            --tw-numeric-spacing: ;
            --tw-numeric-fraction: ;
            --tw-ring-inset: ;
            --tw-ring-offset-width: 0px;
            --tw-ring-offset-color: #fff;
            --tw-ring-color: rgb(59 130 246 / 0.5);
            --tw-ring-offset-shadow: 0 0 #0000;
            --tw-ring-shadow: 0 0 #0000;
            --tw-shadow: 0 0 #0000;
            --tw-shadow-colored: 0 0 #0000;
            --tw-blur: ;
            --tw-brightness: ;
            --tw-contrast: ;
            --tw-grayscale: ;
            --tw-hue-rotate: ;
            --tw-invert: ;
            --tw-saturate: ;
            --tw-sepia: ;
            --tw-drop-shadow: ;
            --tw-backdrop-blur: ;
            --tw-backdrop-brightness: ;
            --tw-backdrop-contrast: ;
            --tw-backdrop-grayscale: ;
            --tw-backdrop-hue-rotate: ;
            --tw-backdrop-invert: ;
            --tw-backdrop-opacity: ;
            --tw-backdrop-saturate: ;
            --tw-backdrop-sepia: ;
            --tw-contain-size: ;
            --tw-contain-layout: ;
            --tw-contain-paint: ;
            --tw-contain-style:
        }

        /* ! tailwindcss v3.4.16 | MIT License | https://tailwindcss.com */
        *,
        ::after,
        ::before {
            box-sizing: border-box;
            border-width: 0;
            border-style: solid;
            border-color: #e5e7eb
        }

        ::after,
        ::before {
            --tw-content: ''
        }

        :host,
        html {
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
            -moz-tab-size: 4;
            tab-size: 4;
            font-family: ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            font-feature-settings: normal;
            font-variation-settings: normal;
            -webkit-tap-highlight-color: transparent
        }

        body {
            margin: 0;
            line-height: inherit
        }

        hr {
            height: 0;
            color: inherit;
            border-top-width: 1px
        }

        abbr:where([title]) {
            -webkit-text-decoration: underline dotted;
            text-decoration: underline dotted
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-size: inherit;
            font-weight: inherit
        }

        a {
            color: inherit;
            text-decoration: inherit
        }

        b,
        strong {
            font-weight: bolder
        }

        code,
        kbd,
        pre,
        samp {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-feature-settings: normal;
            font-variation-settings: normal;
            font-size: 1em
        }

        small {
            font-size: 80%
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative;
            vertical-align: baseline
        }

        sub {
            bottom: -.25em
        }

        sup {
            top: -.5em
        }

        table {
            text-indent: 0;
            border-color: inherit;
            border-collapse: collapse
        }

        button,
        input,
        optgroup,
        select,
        textarea {
            font-family: inherit;
            font-feature-settings: inherit;
            font-variation-settings: inherit;
            font-size: 100%;
            font-weight: inherit;
            line-height: inherit;
            letter-spacing: inherit;
            color: inherit;
            margin: 0;
            padding: 0
        }

        button,
        select {
            text-transform: none
        }

        button,
        input:where([type=button]),
        input:where([type=reset]),
        input:where([type=submit]) {
            -webkit-appearance: button;
            background-color: transparent;
            background-image: none
        }

        :-moz-focusring {
            outline: auto
        }

        :-moz-ui-invalid {
            box-shadow: none
        }

        progress {
            vertical-align: baseline
        }

        ::-webkit-inner-spin-button,
        ::-webkit-outer-spin-button {
            height: auto
        }

        [type=search] {
            -webkit-appearance: textfield;
            outline-offset: -2px
        }

        ::-webkit-search-decoration {
            -webkit-appearance: none
        }

        ::-webkit-file-upload-button {
            -webkit-appearance: button;
            font: inherit
        }

        summary {
            display: list-item
        }

        blockquote,
        dd,
        dl,
        figure,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        hr,
        p,
        pre {
            margin: 0
        }

        fieldset {
            margin: 0;
            padding: 0
        }

        legend {
            padding: 0
        }

        menu,
        ol,
        ul {
            list-style: none;
            margin: 0;
            padding: 0
        }

        dialog {
            padding: 0
        }

        textarea {
            resize: vertical
        }

        input::placeholder,
        textarea::placeholder {
            opacity: 1;
            color: #9ca3af
        }

        [role=button],
        button {
            cursor: pointer
        }

        :disabled {
            cursor: default
        }

        audio,
        canvas,
        embed,
        iframe,
        img,
        object,
        svg,
        video {
            display: block;
            vertical-align: middle
        }

        img,
        video {
            max-width: 100%;
            height: auto
        }

        [hidden]:where(:not([hidden=until-found])) {
            display: none
        }

        .container {
            width: 100%
        }

        @media (min-width: 640px) {
            .container {
                max-width: 640px
            }
        }

        @media (min-width: 768px) {
            .container {
                max-width: 768px
            }
        }

        @media (min-width: 1024px) {
            .container {
                max-width: 1024px
            }
        }

        @media (min-width: 1280px) {
            .container {
                max-width: 1280px
            }
        }

        @media (min-width: 1536px) {
            .container {
                max-width: 1536px
            }
        }

        .col-span-2 {
            grid-column: span 2 / span 2
        }

        .mx-auto {
            margin-left: auto;
            margin-right: auto
        }

        .mb-1 {
            margin-bottom: 0.25rem
        }

        .mb-2 {
            margin-bottom: 0.5rem
        }

        .mb-3 {
            margin-bottom: 0.75rem
        }

        .mb-4 {
            margin-bottom: 1rem
        }

        .mb-6 {
            margin-bottom: 1.5rem
        }

        .mb-8 {
            margin-bottom: 2rem
        }

        .mr-2 {
            margin-right: 0.5rem
        }

        .mt-3 {
            margin-top: 0.75rem
        }

        .mt-6 {
            margin-top: 1.5rem
        }

        .block {
            display: block
        }

        .inline-block {
            display: inline-block
        }

        .flex {
            display: flex
        }

        .grid {
            display: grid
        }

        .hidden {
            display: none
        }

        .h-12 {
            height: 3rem
        }

        .h-16 {
            height: 4rem
        }

        .h-5 {
            height: 1.25rem
        }

        .h-8 {
            height: 2rem
        }

        .min-h-\[500px\] {
            min-height: 500px
        }

        .w-12 {
            width: 3rem
        }

        .w-16 {
            width: 4rem
        }

        .w-5 {
            width: 1.25rem
        }

        .w-8 {
            width: 2rem
        }

        .w-full {
            width: 100%
        }

        .max-w-6xl {
            max-width: 72rem
        }

        .flex-1 {
            flex: 1 1 0%
        }

        .cursor-pointer {
            cursor: pointer
        }

        .grid-cols-1 {
            grid-template-columns: repeat(1, minmax(0, 1fr))
        }

        .grid-cols-2 {
            grid-template-columns: repeat(2, minmax(0, 1fr))
        }

        .items-center {
            align-items: center
        }

        .justify-center {
            justify-content: center
        }

        .justify-between {
            justify-content: space-between
        }

        .gap-3 {
            gap: 0.75rem
        }

        .gap-8 {
            gap: 2rem
        }

        .space-x-3> :not([hidden])~ :not([hidden]) {
            --tw-space-x-reverse: 0;
            margin-right: calc(0.75rem * var(--tw-space-x-reverse));
            margin-left: calc(0.75rem * calc(1 - var(--tw-space-x-reverse)))
        }

        .rounded-lg {
            border-radius: 0.5rem
        }

        .rounded-md {
            border-radius: 0.375rem
        }

        .border {
            border-width: 1px
        }

        .border-b {
            border-bottom-width: 1px
        }

        .border-gray-200 {
            --tw-border-opacity: 1;
            border-color: rgb(229 231 235 / var(--tw-border-opacity, 1))
        }

        .border-gray-300 {
            --tw-border-opacity: 1;
            border-color: rgb(209 213 219 / var(--tw-border-opacity, 1))
        }

        .bg-white {
            --tw-bg-opacity: 1;
            background-color: rgb(255 255 255 / var(--tw-bg-opacity, 1))
        }

        .p-2 {
            padding: 0.5rem
        }

        .p-4 {
            padding: 1rem
        }

        .p-6 {
            padding: 1.5rem
        }

        .p-8 {
            padding: 2rem
        }

        .px-3 {
            padding-left: 0.75rem;
            padding-right: 0.75rem
        }

        .px-4 {
            padding-left: 1rem;
            padding-right: 1rem
        }

        .px-6 {
            padding-left: 1.5rem;
            padding-right: 1.5rem
        }

        .py-1 {
            padding-top: 0.25rem;
            padding-bottom: 0.25rem
        }

        .py-2 {
            padding-top: 0.5rem;
            padding-bottom: 0.5rem
        }

        .py-4 {
            padding-top: 1rem;
            padding-bottom: 1rem
        }

        .py-8 {
            padding-top: 2rem;
            padding-bottom: 2rem
        }

        .text-center {
            text-align: center
        }

        .font-sans {
            font-family: ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"
        }

        .text-4xl {
            font-size: 2.25rem;
            line-height: 2.5rem
        }

        .text-lg {
            font-size: 1.125rem;
            line-height: 1.75rem
        }

        .text-sm {
            font-size: 0.875rem;
            line-height: 1.25rem
        }

        .text-xl {
            font-size: 1.25rem;
            line-height: 1.75rem
        }

        .font-bold {
            font-weight: 700
        }

        .font-medium {
            font-weight: 500
        }

        .font-semibold {
            font-weight: 600
        }

        .text-blue-500 {
            --tw-text-opacity: 1;
            color: rgb(59 130 246 / var(--tw-text-opacity, 1))
        }

        .text-gray-400 {
            --tw-text-opacity: 1;
            color: rgb(156 163 175 / var(--tw-text-opacity, 1))
        }

        .text-gray-500 {
            --tw-text-opacity: 1;
            color: rgb(107 114 128 / var(--tw-text-opacity, 1))
        }

        .text-gray-600 {
            --tw-text-opacity: 1;
            color: rgb(75 85 99 / var(--tw-text-opacity, 1))
        }

        .text-gray-700 {
            --tw-text-opacity: 1;
            color: rgb(55 65 81 / var(--tw-text-opacity, 1))
        }

        .text-gray-800 {
            --tw-text-opacity: 1;
            color: rgb(31 41 55 / var(--tw-text-opacity, 1))
        }

        .shadow-lg {
            --tw-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);
            box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)
        }

        .focus\:outline-none:focus {
            outline: 2px solid transparent;
            outline-offset: 2px
        }

        .focus\:ring-2:focus {
            --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
            --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);
            box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)
        }

        .focus\:ring-blue-500:focus {
            --tw-ring-opacity: 1;
            --tw-ring-color: rgb(59 130 246 / var(--tw-ring-opacity, 1))
        }

        @media (min-width: 1024px) {
            .lg\:col-span-1 {
                grid-column: span 1 / span 1
            }

            .lg\:col-span-2 {
                grid-column: span 2 / span 2
            }

            .lg\:grid-cols-3 {
                grid-template-columns: repeat(3, minmax(0, 1fr))
            }
        }
    </style>
</head>

<body class="font-sans" data-new-gr-c-s-check-loaded="14.1235.0" data-gr-ext-installed="">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">PDF Signer</h1>
            <p class="text-gray-600">Upload, sign, and download your documents securely</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Panel: Upload and Signature Tools -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Upload Document</h2>
                    <div id="upload-area" class="upload-area rounded-lg p-8 text-center cursor-pointer">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-blue-500 mb-3" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12">
                            </path>
                        </svg>
                        <p class="text-gray-600 mb-2">Drag &amp; drop your PDF here or</p>
                        <button id="browse-btn" class="btn-primary py-2 px-4 rounded-md inline-block cursor-pointer">
                            Browse Files
                        </button>
                        <input type="file" id="pdf-upload" accept="application/pdf" class="hidden">

                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Signature Options</h2>

                    <div class="border-b border-gray-200 mb-4">
                        <div class="flex">
                            <button id="draw-tab"
                                class="signature-tab active flex-1 py-2 px-4 text-center">Draw</button>
                            <button id="upload-tab" class="signature-tab flex-1 py-2 px-4 text-center">Upload</button>
                            <button id="type-tab" class="signature-tab flex-1 py-2 px-4 text-center">Type</button>
                        </div>
                    </div>

                    <div id="draw-signature-panel" class="signature-panel">
                        <canvas id="signature-pad" class="signature-pad w-full" height="150"></canvas>
                        <div class="flex justify-between mt-3">
                            <button id="clear-signature" class="btn-secondary py-2 px-4 rounded-md">Clear</button>
                            <button id="save-signature" class="btn-primary py-2 px-4 rounded-md">Save</button>
                        </div>
                    </div>

                    <div id="upload-signature-panel" class="signature-panel hidden">
                        <div class="upload-area rounded-lg p-4 text-center cursor-pointer">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto text-blue-500 mb-2"
                                fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                                </path>
                            </svg>
                            <p class="text-gray-600 mb-2">Upload signature image</p>
                            <label class="btn-primary py-1 px-3 rounded-md inline-block cursor-pointer text-sm">
                                Choose Image
                                <input type="file" id="signature-upload" accept="image/*" class="hidden">
                            </label>
                        </div>
                    </div>

                    <div id="type-signature-panel" class="signature-panel hidden">
                        <div class="mb-3">
                            <input type="text" id="typed-signature" placeholder="Type your signature"
                                class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="mb-3">
                            <label class="block text-sm text-gray-600 mb-1">Font Style</label>
                            <select id="font-style"
                                class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="Dancing Script">Handwritten</option>
                                <option value="Pacifico">Signature</option>
                                <option value="Caveat">Casual</option>
                            </select>
                        </div>
                        <button id="create-typed-signature" class="btn-primary py-2 px-4 rounded-md w-full">Create
                            Signature</button>
                    </div>

                    <div class="mt-6">
                        <h3 class="text-lg font-medium mb-2 text-gray-700">Your Signatures</h3>
                        <div id="signatures-container" class="grid grid-cols-2 gap-3">
                            <div class="text-center text-gray-500 col-span-2 py-4">
                                No signatures yet
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: PDF Preview -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Document Preview</h2>
                    <div id="pdf-container" class="pdf-container p-4 min-h-[500px] flex items-center justify-center">
                        <div class="text-center text-gray-500">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-gray-400 mb-3"
                                fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                </path>
                            </svg>
                            <p class="text-lg">Upload a PDF to get started</p>
                        </div>
                    </div>
                    <div class="mt-6 flex justify-between items-center">
                        <div>
                            <span id="page-num" class="text-gray-600">0</span>
                            <span class="text-gray-600"> / </span>
                            <span id="page-count" class="text-gray-600">0</span>
                        </div>
                        <div class="flex space-x-3">
                            <button id="prev-page" class="btn-secondary py-2 px-4 rounded-md"
                                disabled="">Previous</button>
                            <button id="next-page" class="btn-secondary py-2 px-4 rounded-md" disabled="">Next</button>
                        </div>
                        <button id="download-pdf" class="btn-primary py-2 px-6 rounded-md flex items-center"
                            disabled="">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                            </svg>
                            Download
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load required fonts
        document.head.innerHTML += `<link href="https://fonts.googleapis.com/css2?family=Dancing+Script&family=Pacifico&family=Caveat&display=swap" rel="stylesheet">`;

        // Global variables
        let pdfDoc = null;       // pdf-lib doc for editing
        let pdfJsDoc = null;     // PDF.js doc for rendering
        let originalPdfBytes = null; // ðŸ”’ renamed
        let pageNum = 1;
        let pageRendering = false;
        let pageNumPending = null;
        let scale = 1.5;
        let canvas = null;
        let ctx = null;
        let signaturePad = null;
        let signatures = [];
        let activeSignature = null;
        let signaturePositions = [];
        let isDragging = false;
        let dragOffsetX = 0;
        let dragOffsetY = 0;
        let currentDragElement = null;


        // Initialize signature pad
        function initSignaturePad() {
            const signatureCanvas = document.getElementById('signature-pad');
            signaturePad = new SignaturePad(signatureCanvas, {
                backgroundColor: 'rgb(0, 0, 0, 0)',
                penColor: 'rgb(0, 0, 0)'
            });

            // Adjust canvas size
            function resizeCanvas() {
                const ratio = Math.max(window.devicePixelRatio || 1, 1);
                signatureCanvas.width = signatureCanvas.offsetWidth * ratio;
                signatureCanvas.height = signatureCanvas.offsetHeight * ratio;
                signatureCanvas.getContext("2d").scale(ratio, ratio);
                signaturePad.clear();
            }

            window.addEventListener("resize", resizeCanvas);
            resizeCanvas();
        }

        // Tab switching
        function setupTabs() {
            const tabs = ['draw', 'upload', 'type'];
            tabs.forEach(tab => {
                document.getElementById(`${tab}-tab`).addEventListener('click', () => {
                    // Hide all panels and remove active class
                    tabs.forEach(t => {
                        document.getElementById(`${t}-signature-panel`).classList.add('hidden');
                        document.getElementById(`${t}-tab`).classList.remove('active');
                    });

                    // Show selected panel and add active class
                    document.getElementById(`${tab}-signature-panel`).classList.remove('hidden');
                    document.getElementById(`${tab}-tab`).classList.add('active');
                });
            });
        }

        // Handle PDF upload
        function setupPdfUpload() {
            const uploadArea = document.getElementById('upload-area');
            const pdfUpload = document.getElementById('pdf-upload');

            // Variable to track if the dialog has already been triggered
            let isDialogOpen = false;

            uploadArea.addEventListener('click', () => {
                if (!isDialogOpen) {
                    isDialogOpen = true;
                    pdfUpload.click();
                }
            });

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('border-blue-500');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('border-blue-500');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('border-blue-500');

                if (e.dataTransfer.files.length) {
                    const file = e.dataTransfer.files[0];
                    if (file.type === 'application/pdf') {
                        handlePdfFile(file);
                    } else {
                        alert('Please upload a PDF file');
                    }
                }
            });

            pdfUpload.addEventListener('change', (e) => {
                // Reset the dialog open status when a file is selected
                isDialogOpen = false

                if (e.target.files.length) {
                    const file = e.target.files[0];
                    console.log('Selected file size:', file.size);
                    if (file.type === 'application/pdf') {
                        handlePdfFile(file);
                    }
                    else if (file.size === 0) {
                        alert('Empty PDF file selected. Please choose a valid PDF.');
                        return;
                    }
                    else {
                        alert('Please upload a PDF file');
                    }
                }
            });
        }

        //Handle scaling of the canvas 
        function getScaledCoordinates(e) {
            const rect = canvas.getBoundingClientRect();

            // Calculate the scale factor (relative to the canvas/container size)
            const scaleX = rect.width / canvas.width; // Horizontal scale factor
            const scaleY = rect.height / canvas.height; // Vertical scale factor

            // Get the mouse position relative to the canvas/container
            const x = (e.clientX - rect.left) / scaleX; // Adjust based on scaling
            const y = (e.clientY - rect.top) / scaleY; // Adjust based on scaling

            return { x, y };
        }

        // Handle PDF file loading
        async function handlePdfFile(file) {
            const fileReader = new FileReader();

            fileReader.onload = async function () {
                const arrayBuffer = this.result;
                console.log('FileReader result byteLength:', arrayBuffer?.byteLength);

                if (!arrayBuffer || arrayBuffer.byteLength === 0) {
                    alert('Uploaded file is empty or invalid. Please try again.');
                    return;
                }

                originalPdfBytes = arrayBuffer.slice(0);
                console.log('originalPdfBytes cloned byteLength:', originalPdfBytes.byteLength);

                if (!(originalPdfBytes instanceof ArrayBuffer) || originalPdfBytes.byteLength === 0) {
                    console.error('Invalid PDF data (empty buffer)');
                    alert('Failed to read PDF. Please try again.');
                    return;
                }

                try {
                    const [pdfLibInstance, pdfJsInstance] = await Promise.all([
                        PDFLib.PDFDocument.load(originalPdfBytes),
                        pdfjsLib.getDocument({ data: new Uint8Array(arrayBuffer) }).promise
                    ]);

                    pdfDoc = pdfLibInstance;
                    pdfJsDoc = pdfJsInstance;
                    pageNum = 1;

                    document.getElementById('page-count').textContent = pdfDoc.getPageCount();
                    document.getElementById('page-num').textContent = pageNum;
                    document.getElementById('prev-page').disabled = true;
                    document.getElementById('next-page').disabled = pdfDoc.getPageCount() <= 1;
                    document.getElementById('download-pdf').disabled = false;

                    renderPage(pageNum);
                } catch (err) {
                    console.error('Error loading PDF:', err);
                    alert('Error reading PDF. Please try a different file.');
                }
            };


            fileReader.readAsArrayBuffer(file);
        }

        // Render PDF page
        async function renderPage(num) {
            if (pageRendering) {
                pageNumPending = num;
                return;
            }

            pageRendering = true;

            const pdfContainer = document.getElementById('pdf-container');
            pdfContainer.innerHTML = '';

            try {
                const page = await pdfJsDoc.getPage(num);     // âœ… from PDF.js
                const viewport = page.getViewport({ scale });

                canvas = document.createElement('canvas');
                canvas.className = 'pdf-page mx-auto';
                canvas.style.width = "100%";
                canvas.style.height = "auto";
                canvas.width = viewport.width;
                canvas.height = viewport.height;
                pdfContainer.appendChild(canvas);

                ctx = canvas.getContext('2d');

                const renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };

                await page.render(renderContext).promise;

                // Add event listener for placing signatures
                canvas.addEventListener('click', handleCanvasClick);

                // Render existing signatures for this page
                renderSignaturesOnPage(num);

                pageRendering = false;

                if (pageNumPending !== null) {
                    renderPage(pageNumPending);
                    pageNumPending = null;
                }
            } catch (error) {
                console.error('Error rendering page:', error);
                pageRendering = false;
            }
        }

        // Handle page navigation
        function setupPageNavigation() {
            document.getElementById('prev-page').addEventListener('click', () => {
                if (pageNum <= 1) return;
                pageNum--;
                document.getElementById('page-num').textContent = pageNum;
                document.getElementById('prev-page').disabled = pageNum <= 1;
                document.getElementById('next-page').disabled = pageNum >= pdfDoc.getPageCount();
                renderPage(pageNum);
            });

            document.getElementById('next-page').addEventListener('click', () => {
                if (pageNum >= pdfDoc.getPageCount()) return;
                pageNum++;
                document.getElementById('page-num').textContent = pageNum;
                document.getElementById('prev-page').disabled = pageNum <= 1;
                document.getElementById('next-page').disabled = pageNum >= pdfDoc.getPageCount();
                renderPage(pageNum);
            });
        }

        // Handle signature creation
        function setupSignatureCreation() {
            // Clear signature button
            document.getElementById('clear-signature').addEventListener('click', () => {
                signaturePad.clear();
            });

            // Save drawn signature
            document.getElementById('save-signature').addEventListener('click', () => {
                if (signaturePad.isEmpty()) {
                    alert('Please provide a signature');
                    return;
                }

                const signatureDataURL = signaturePad.toDataURL('image/png');
                addSignature(signatureDataURL, 'drawn');
                signaturePad.clear();
            });

            // Upload signature image
            document.getElementById('signature-upload').addEventListener('change', (e) => {
                if (e.target.files.length) {
                    const file = e.target.files[0];
                    if (!file.type.startsWith('image/')) {
                        alert('Please upload an image file');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function (event) {
                        addSignature(event.target.result, 'uploaded');
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Create typed signature
            document.getElementById('create-typed-signature').addEventListener('click', () => {
                const text = document.getElementById('typed-signature').value.trim();
                if (!text) {
                    alert('Please type your signature');
                    return;
                }

                const fontFamily = document.getElementById('font-style').value;

                // Create canvas to generate signature
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');

                // Set canvas size
                canvas.width = text.length * 20;
                canvas.height = 60;

                // Draw background
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Draw text
                ctx.fillStyle = 'black';
                ctx.font = `30px "${fontFamily}", cursive`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(text, canvas.width / 2, canvas.height / 2);

                const signatureDataURL = canvas.toDataURL();
                addSignature(signatureDataURL, 'typed');

                document.getElementById('typed-signature').value = '';
            });
        }

        // Add signature to the collection
        function addSignature(dataURL, type) {
            const id = `sig-${Date.now()}`;
            signatures.push({
                id,
                dataURL,
                type
            });

            updateSignaturesContainer();
        }

        // Update signatures container
        function updateSignaturesContainer() {
            const container = document.getElementById('signatures-container');

            if (signatures.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 col-span-2 py-4">
                        No signatures yet
                    </div>
                `;
                return;
            }

            container.innerHTML = '';

            signatures.forEach(signature => {
                const signatureItem = document.createElement('div');
                signatureItem.className = `signature-item p-2 border rounded-md ${activeSignature === signature.id ? 'selected' : ''}`;
                signatureItem.innerHTML = `
                    <img src="${signature.dataURL}" alt="Signature" class="w-full h-auto">
                    <div class="flex justify-between mt-1">
                        <button class="text-xs text-red-500 use-signature" data-id="${signature.id}">Use</button>
                        <button class="text-xs text-gray-500 delete-signature" data-id="${signature.id}">Delete</button>
                    </div>
                `;
                container.appendChild(signatureItem);
            });

            // Add event listeners
            document.querySelectorAll('.use-signature').forEach(button => {
                button.addEventListener('click', (e) => {
                    const id = e.target.dataset.id;
                    activeSignature = id;
                    updateSignaturesContainer();

                    // âœ… Show instruction tooltip
                    showPlacementTooltip();

                    // âœ… Change cursor to indicate placement mode
                    document.querySelector('.pdf-container').style.cursor = 'crosshair';
                });
            });


            document.querySelectorAll('.delete-signature').forEach(button => {
                button.addEventListener('click', (e) => {
                    const id = e.target.dataset.id;
                    signatures = signatures.filter(sig => sig.id !== id);
                    if (activeSignature === id) {
                        activeSignature = null;
                    }
                    updateSignaturesContainer();
                });
            });
        }

        // Placement tooltip
        function showPlacementTooltip() {
            const tooltip = document.createElement('div');
            tooltip.innerText = "Click on the PDF to place your signature";
            tooltip.style.position = 'fixed';
            tooltip.style.top = '20px';
            tooltip.style.left = '50%';
            tooltip.style.transform = 'translateX(-50%)';
            tooltip.style.background = '#3b82f6';
            tooltip.style.color = 'white';
            tooltip.style.padding = '8px 16px';
            tooltip.style.borderRadius = '8px';
            tooltip.style.zIndex = 9999;
            tooltip.style.boxShadow = '0 2px 6px rgba(0,0,0,0.2)';
            document.body.appendChild(tooltip);
            setTimeout(() => tooltip.remove(), 3000);
        }


        // Handle canvas click for placing signatures
        function handleCanvasClick(e) {
            if (!activeSignature) {
                alert('Please select a signature first');
                return;
            }

            const signature = signatures.find(sig => sig.id === activeSignature);
            if (!signature) return;

            const rect = canvas.getBoundingClientRect();

            // Calculate relative coordinates inside canvas
            const canvasX = e.clientX - rect.left;
            const canvasY = e.clientY - rect.top;

            // Center signature at click
            const width = 150;
            const height = 60;
            const centeredX = canvasX - width / 2;
            const centeredY = canvasY - height / 2;

            console.log(`Canvas: x=${rect.x}, y=${rect.y}, width=${rect.width}, height=${rect.height}`);
            console.log(`Click (relative to canvas): x=${canvasX}, y=${canvasY}`);
            console.log(`Placing signature at (centered): x=${centeredX}, y=${centeredY}`);

            const positionId = `pos-${Date.now()}`;
            signaturePositions.push({
                id: positionId,
                signatureId: activeSignature,
                page: pageNum,
                x: centeredX,
                y: centeredY,
                width,
                height
            });

            renderSignaturesOnPage(pageNum);
            // âœ… Reset cursor to default after placing
            document.querySelector('.pdf-container').style.cursor = 'default';

        }

        // Render signatures on the current page
        function renderSignaturesOnPage(pageNumber) {
            // Remove existing
            document.querySelectorAll('.drag-signature').forEach(el => el.remove());

            const pageSignatures = signaturePositions.filter(pos => pos.page === pageNumber);

            pageSignatures.forEach(position => {
                const signature = signatures.find(sig => sig.id === position.signatureId);
                if (!signature) return;

                const el = document.createElement('div');
                el.className = 'drag-signature absolute';
                el.dataset.id = position.id;

                // Position exactly where it was stored
                el.style.left = `${position.x}px`;
                el.style.top = `${position.y}px`;
                el.style.width = `${position.width}px`;
                el.style.height = `${position.height}px`;
                el.style.position = 'absolute';
                el.style.cursor = 'move';

                const img = document.createElement('img');
                img.src = signature.dataURL;
                img.className = 'w-full h-full object-contain';
                el.appendChild(img);

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'absolute -top-3 -right-3 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center';
                deleteBtn.innerHTML = 'Ã—';
                deleteBtn.addEventListener('click', () => {
                    signaturePositions = signaturePositions.filter(pos => pos.id !== position.id);
                    el.remove();
                });
                el.appendChild(deleteBtn);



                document.getElementById('pdf-container').appendChild(el);
            });
        }

        // Handle dragging signatures
        function setupDragging() {
            document.addEventListener('mousemove', (e) => {
                if (!isDragging || !currentDragElement) return;

                const container = document.getElementById('pdf-container');
                const containerRect = container.getBoundingClientRect();

                const canvas = document.getElementById('pdf-canvas');
                const canvasRect = canvas.getBoundingClientRect();

                // Calculate new position relative to container
                let newX = e.clientX - dragOffsetX;
                let newY = e.clientY - dragOffsetY;

                // Constrain within container
                newX = Math.max(0, Math.min(newX, containerRect.width - currentDragElement.offsetWidth));
                newY = Math.max(0, Math.min(newY, containerRect.height - currentDragElement.offsetHeight));

                // Update signature element position (CSS)
                currentDragElement.style.left = `${newX}px`;
                currentDragElement.style.top = `${newY}px`;

                // Convert container coords to canvas coords
                const canvasX = newX - (canvasRect.left - containerRect.left);
                const canvasY = newY - (canvasRect.top - containerRect.top);

                console.log('[Dragging] Updated canvas position for:', currentDragElement.dataset.id, {
                    x: canvasX,
                    y: canvasY
                });

                // Update signaturePositions array
                const positionId = currentDragElement.dataset.id;
                const positionIndex = signaturePositions.findIndex(pos => pos.id === positionId);
                if (positionIndex !== -1) {
                    signaturePositions[positionIndex].x = canvasX;
                    signaturePositions[positionIndex].y = canvasY;
                }
            });

            document.addEventListener('mouseup', () => {
                if (isDragging && currentDragElement) {
                    currentDragElement.style.opacity = '1';
                }
                isDragging = false;
                currentDragElement = null;
            });
        }

        // Handle PDF download with signatures
        async function setupPdfDownload() {


            document.getElementById('download-pdf').addEventListener('click', async () => {
                console.log('[Download] Starting PDF generation...');
                console.log('â†’ All signature positions:', JSON.stringify(signaturePositions, null, 2));
                if (!pdfDoc || signaturePositions.length === 0) {
                    alert('Please add at least one signature to the document');
                    return;
                }

                // âœ… Add this guard here
                if (!originalPdfBytes || !(originalPdfBytes instanceof ArrayBuffer) || originalPdfBytes.byteLength === 0) {
                    alert("PDF file is not loaded properly. Please re-upload and try again.");
                    console.error('Invalid or missing pdfBytes:', originalPdfBytes);
                    return;
                }

                try {
                    const { PDFDocument } = PDFLib;
                    if (!originalPdfBytes || !(originalPdfBytes instanceof ArrayBuffer) || originalPdfBytes.byteLength === 0) {
                        alert("PDF file is not loaded properly. Please re-upload and try again.");
                        console.error('Invalid or missing pdfBytes:', originalPdfBytes);
                        return;
                    }
                    const newPdfDoc = await PDFDocument.load(originalPdfBytes);

                    // Group signatures by page
                    const signaturesByPage = {};
                    signaturePositions.forEach(position => {
                        if (!signaturesByPage[position.page]) {
                            signaturesByPage[position.page] = [];
                        }
                        signaturesByPage[position.page].push(position);
                    });

                    // Process each page
                    for (const [pageIndex, positions] of Object.entries(signaturesByPage)) {
                        const pageIdx = parseInt(pageIndex) - 1;
                        const page = newPdfDoc.getPage(pageIdx);
                        const { width, height } = page.getSize();

                        for (const position of positions) {
                            const signature = signatures.find(sig => sig.id === position.signatureId);
                            if (!signature) continue;

                            // Convert data URL to bytes
                            const base64Data = signature.dataURL.split(',')[1];
                            const imageBytes = Uint8Array.from(atob(base64Data), c => c.charCodeAt(0));

                            let image;
                            try {
                                image = await newPdfDoc.embedPng(imageBytes);
                            } catch {
                                image = await newPdfDoc.embedJpg(imageBytes);
                            }

                            // ðŸ” Use canvas.getBoundingClientRect() for accurate scaling
                            const canvasRect = canvas.getBoundingClientRect();

                            // Canvas click coords in DOM pixels
                            const clickX = position.x;
                            const clickY = position.y;
                            const sigWidth = position.width;
                            const sigHeight = position.height;

                            // DOM pixels â†’ PDF points (scale)
                            const scaleX = width / canvasRect.width;
                            const scaleY = height / canvasRect.height;

                            // Top-left â†’ Bottom-left
                            const pdfX = clickX * scaleX;
                            const pdfY = height - (clickY + sigHeight) * scaleY;

                            page.drawImage(image, {
                                x: pdfX,
                                y: pdfY,
                                width: sigWidth * scaleX,
                                height: sigHeight * scaleY
                            });

                            console.log(`[Download] Signature placed at PDF coordinates: (${pdfX}, ${pdfY})`);


                        }
                    }

                    // Save the PDF
                    const signedpdfBytes = await newPdfDoc.save();
                    download(signedpdfBytes, 'signed-document.pdf', 'application/pdf');

                } catch (error) {
                    console.error('Error generating signed PDF:', error);
                    alert('Error generating signed PDF. Please try again.');
                }
            });
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            initSignaturePad();
            setupTabs();
            setupPdfUpload();
            setupPageNavigation();
            setupSignatureCreation();
            setupDragging();
            setupPdfDownload();
        });

    </script>
    <footer class="text-center text-sm text-gray-400 mt-4">
        Â© 2025 staknet | Do not self-host or redistribute without <a href="LICENSE">permission</a>
    </footer>
</body>

</html>
